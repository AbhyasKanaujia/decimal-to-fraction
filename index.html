<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Decimal to Close Fractions</title>
    <link href="css/bootstrap.css" rel="stylesheet">
    <script src="js/bootstrap.js"></script>
    <style>
        .numerator::after {
            content: '';
            display: block;
            width: 100%;
            height: 3px;
            background-color: black;
        }

        .other-results-list .numerator::after {
            height: 2px;
            background-color: #777;
        }

        .hidden-while-loading {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- HEADER -->
    <h1 class="display-1 my-3">Decimal to Fraction</h1>

    <!-- INPUT -->
    <div class="mb-1 decimal-input-container">
        <label class="form-label" for="decimalInput">Enter a Decimal Number (0-<span id="max">100</span>):</label>
        <input class="form-control" id="decimalInput" min="0" placeholder="e.g. 3.5" step="0.1" type="number">
    </div>

    <div class="mb-3"></div>

    <!-- MAIN RESULT -->
    <div class="main-result-container my-4 d-flex gap-4 display-1 align-items-center justify-content-center text-center">
        <div class="fraction">
            <div class="numerator">N</div>
            <div class="denominator">M</div>
        </div>
        <div>≈</div>
        <div class="decimal">Result of N/M</div>
    </div>

    <!-- OTHER RESULTS -->
    <div class="other-results-container my-4 text-center">
        <p class="text-muted my-3">Other Results</p>
        <ul class="other-results-list d-flex list-unstyled gap-5 flex-wrap text-muted">
            <li class="text-muted d-flex gap-2 align-items-center">
                <div class="fraction">
                    <div class="numerator">1</div>
                    <div class="denominator">3</div>
                </div>
                <div>≈</div>
                <div class="decimal">0.33</div>
            </li>
        </ul>
    </div>
</div>
</body>
<script defer>
    // Constants
    const MAX_FRACTIONAL_REPRESENTATIONS = 100;
    const MAX_DENOMINATOR = 100;
    const DEBOUNCE_DELAY = 500;

    // Variables
    let timeoutID = null;

    // DOM Elements
    const $decimalInputContainer = document.querySelector('.decimal-input-container');
    const $decimalInput = $decimalInputContainer.querySelector('#decimalInput');

    const $mainResultContainer = document.querySelector('.main-result-container');
    const $mainResultNumerator = $mainResultContainer.querySelector('.numerator');
    const $mainResultDenominator = $mainResultContainer.querySelector('.denominator');
    const $mainResultDecimal = $mainResultContainer.querySelector('.decimal');

    const $otherResultsContainer = document.querySelector('.other-results-container');
    const $otherResultsList = $otherResultsContainer.querySelector('.other-results-list');



    // Functions
    function findClosestFractions(decimal, maxResults) {
        const results = [];
        for (let denominator = 1; results.length < maxResults && denominator <= MAX_DENOMINATOR; denominator++) {
            const numerator = Math.round(decimal * denominator);
            const fractionValue = numerator / denominator;
            results.push({
                numerator,
                denominator,
                value: fractionValue,
                difference: Math.abs(fractionValue - decimal),
            });
        }
        return results
            .sort((a, b) => a.difference - b.difference) // Sort by closeness
            .slice(0, maxResults); // Keep only the top results
    }

    // UI Functions

    function createOtherResult(fractionalRepresentation) {
        const $li = document.createElement('li');
        $li.classList.add('d-flex', 'gap-2', 'align-items-center');
        const $fraction = document.createElement('div');
        $fraction.classList.add('fraction');

        const $numerator = document.createElement('div');
        $numerator.classList.add('numerator');
        $numerator.textContent = fractionalRepresentation.numerator;

        const $denominator = document.createElement('div');
        $denominator.classList.add('denominator');
        $denominator.textContent = fractionalRepresentation.denominator;

        $fraction.appendChild($numerator);
        $fraction.appendChild($denominator);

        const $approx = document.createElement('div');
        $approx.textContent = '≈';

        const $decimal = document.createElement('div');
        $decimal.classList.add('decimal');
        $decimal.textContent = (fractionalRepresentation.numerator / fractionalRepresentation.denominator).toFixed(2);

        $li.appendChild($fraction);
        $li.appendChild($approx);
        $li.appendChild($decimal);
        return $li;
    }

    function resetOutput() {
        $mainResultNumerator.textContent = 'N';
        $mainResultDenominator.textContent = 'D';
        $mainResultDecimal.textContent = 'Result of N/M';
        $otherResultsList.innerHTML = '';
    }

    function displayResults(sortedFractions) {
        const [mainResult, ...otherResults] = sortedFractions;

        $mainResultNumerator.textContent = mainResult.numerator;
        $mainResultDenominator.textContent = mainResult.denominator;
        $mainResultDecimal.textContent = (mainResult.numerator / mainResult.denominator).toFixed(2);

        otherResults.forEach(fractionalRepresentation => {
            const $li = createOtherResult(fractionalRepresentation);
            $otherResultsList.appendChild($li);
        });
    }

    function hideWhileLoading() {
        $mainResultContainer.classList.add('hidden-while-loading');
        $otherResultsContainer.classList.add('hidden-while-loading');
    }

    function showAfterLoading() {
        $mainResultContainer.classList.remove('hidden-while-loading');
        $otherResultsContainer.classList.remove('hidden-while-loading');
    }


    // Event Listeners
    $decimalInput.addEventListener('input', function () {
        hideWhileLoading();
        clearTimeout(timeoutID);
        timeoutID = setTimeout(() => {
            const targetValue = parseFloat(this.value);
            if (isNaN(targetValue)) return;
            resetOutput();
            const sortedFractions = findClosestFractions(targetValue, 10);
            displayResults(sortedFractions);
            showAfterLoading();
        }, DEBOUNCE_DELAY);
    });

    // Initialize App
    $decimalInputContainer.querySelector('#max').textContent = MAX_FRACTIONAL_REPRESENTATIONS.toString();
    $decimalInput.max = MAX_FRACTIONAL_REPRESENTATIONS;
</script>
</html>